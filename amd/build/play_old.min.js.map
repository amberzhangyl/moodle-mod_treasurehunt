{"version":3,"sources":["../src/play_old.js"],"names":["define","$","url","ol","ajax","GeocoderJS","viewgpx","console","log","jquery","playtreasurehunt","cmid","treasurehuntid","playwithoutmoving","groupmode","lastattempttimestamp","lastroadtimestamp","gameupdatetime","tracking","user","custommapconfig","map","term","key","component","i18n","i18nplay","custombackgroundurl","img","Image","addEventListener","imgwidth","naturalWidth","imgheight","naturalHeight","initplaytreasurehunt","src","strings","mobile","loading","custombaselayer","geographictools","defaultzoom","customimageextent","proj","transformExtent","bbox","geographic","bboxwidth","bboxheight","centerwidth","centerheight","ratiorealmap","Math","round","adjwidth","adjheight","layer","title","layername","name","type","layertype","source","ImageStatic","imageExtent","opacity","wmsurl","options","TileWMS","params","wmsparams","customwmsextent","extent","Tile","hide","parchmenturl","imageUrl","failureurl","markerurl","openStreetMapGeocoder","createGeocoder","lastsuccessfulstage","interval","imgloaded","totalimg","infomsgs","attemptshistory","changesinattemptshistory","changesinlastsuccessfulstage","changesinquestionstage","fitmap","roadfinished","available","qoaremoved","text","style","Text","textAlign","scale","fill","Fill","color","stroke","Stroke","width","selectText","defaultstageStyle","Style","image","Icon","anchor","zIndex","failstageStyle","defaultSelectstageStyle","failSelectstageStyle","positionFeatureStyle","Circle","radius","accuracyFeatureStyle","markerFeatureStyle","layers","geoJSONFormat","format","GeoJSON","Vector","projection","attemptslayer","feature","stageposition","get","styles","getText","setText","aeriallayer","visible","BingMaps","imagerySet","maxZoom","set","roadlayer","OSM","layersbase","layersoverlay","onlybase","push","layergroup","Group","toplayer","getLayers","forEach","setVisible","view","View","center","zoom","minZoom","select","interaction","Select","filter","accuracyFeature","Feature","setProperties","setStyle","positionFeature","userPosition","features","markerFeature","setGeometry","markerVector","concat","control","Zoom","target","className","Map","controls","loadTilesWhileAnimating","loadTilesWhileInteracting","addInteraction","renew_source","setInterval","item","getVisible","append","href","click","l","on","toggleClass","insertAfter","overlay","add_layer_to_list","tracklayergroup","addgpxlayer","tracklayer","htmltitle","plaintitle","substring","indexOf","validateposition","getGeometry","toast","autocentermap","position","geolocation","getPosition","fly_to","point","getView","fit","duration","animate","location","initialize","selectedanswerid","qrtext","currentposition","coordinates","answerid","writeGeometryObject","dataProjection","featureProjection","geojson","call","methodname","args","userprogress","attempttimestamp","roadtimestamp","done","response","body","status","msg","qrexpected","show","historicalattempts","length","attempts","firststagegeom","clear","addFeatures","readFeatures","question","activitysolved","pageId","pageContainer","pagecontainer","prop","set_lastsuccessfulstage","fit_map_to_source","set_question","set_attempts_history","resetActivePageHeight","infomsg","create_popup","clearInterval","css","fail","error","message","getFeatures","geom","Point","getCoordinates","getExtent","totalnumber","briefing","clue","replace","html","clueplaintext","truncate","collapsibleset","panel","collapsible","counter","each","answers","answer","id","answertext","$historylist","appendTo","attempt","penalty","string","listview","trigger","Geolocation","getProjection","trackingOptions","enableHighAccuracy","maximumAge","timeout","getAccuracyGeometry","trackinggeolocationwarndispatched","code","PERMISSION_DENIED","setTimeout","popup","positionTo","setTracking","selected","stagename","stageclue","info","get_block_text","evt","hasFeature","forEachFeatureAtPixel","getEventPixel","originalEvent","getEventCoordinate","e","data","$ul","value","input","val","textVisible","theme","geocode","i","place","totalName","parseFloat","boundingbox","innerinfopanel","scrollTop","parseInt","offset","top","document","maxHeight","window","height","remove","event","updateSize","beforeclose","preventDefault","autoInitializePage","initializePage","viewport","querySelector","setAttribute","beforeposition","innerWidth","innerHeight","afteropen","contentdiv","find","first","headerdiv","padding","loadQR","qrReaded","qrReport","afterclose","unloadQR","detectedCameras","nextcam","getnextwebCam","setnextwebcam","close_popup","cameras","camera","left","delay","fadeOut","header","content","attributes","attr","activePage","toolbar","after","one","open_popup","clearTimeout","fallback"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * @module    mod_treasurehunt/play\r\n * @package   mod_treasurehunt\r\n * @copyright 2016 onwards Adrian Rodriguez Fernandez <huorwhisp@gmail.com>, Juan Pablo de Castro <jpdecastro@tel.uva.es>\r\n * @author Adrian Rodriguez <huorwhisp@gmail.com>\r\n * @author Juan Pablo de Castro <jpdecastro@tel.uva.es>\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine(['jquery',  \r\n    'core/url',\r\n    'mod_treasurehunt/ol',\r\n    'core/ajax',\r\n    'mod_treasurehunt/geocoder',\r\n    'mod_treasurehunt/viewgpx',\r\n    // 'core/str',\r\n    'mod_treasurehunt/jquery.truncate', \r\n    'mod_treasurehunt/jquery.mobile-config',\r\n    'mod_treasurehunt/jquerymobile', \r\n    ],\r\n\t    function ($, url, ol, ajax, GeocoderJS, viewgpx /*, str*/) {\r\n\t\t\tconsole.log('loading play.js with jquery ' + $().jquery);\r\n\t        var init = {\r\n\t            playtreasurehunt: function (cmid, treasurehuntid, playwithoutmoving, groupmode,\r\n\t                    lastattempttimestamp,\r\n\t                    lastroadtimestamp, gameupdatetime, tracking, user, custommapconfig) {\r\n\t\t\t\t\t\r\n\t            \t// I18n strings.\r\n\t            \tvar terms = [\"stageovercome\", \"failedlocation\", \"stage\", \"stagename\",\r\n\t\t\t\t\t\t\t\t\t        \"stageclue\", \"question\", \"noanswerselected\", \"timeexceeded\",\r\n\t\t\t\t\t\t\t\t\t        \"searching\", \"continue\", \"noattempts\", \"aerialview\", \"roadview\", \r\n\t\t\t\t\t\t\t\t\t        \"noresults\", \"startfromhere\", \"nomarks\", \"updates\", \"activitytoendwarning\",\r\n\t\t\t\t\t\t\t\t\t        \"huntcompleted\", \"discoveredlocation\", \"answerwarning\", \"error\"];\r\n\t\t\t\t\tconsole.log('loading i18n strings');\r\n\t            \tvar stringsqueried = terms.map(function (term) {\r\n\t                     return {key: term, component: 'treasurehunt'};\r\n\t\t\t\t\t});\r\n\t\t\t\t\ti18n = i18nplay; // Use globally passed strings. Moodle 3.8 core/str broke with jquery 2.1.4.\r\n\t            \t//str.get_strings(stringsqueried).done(function (strings) {\r\n\t            \t\t// var i18n = [];\r\n\t            \t\t// for (var i=0; i < terms.length; i++) {\r\n\t            \t\t// \ti18n[terms[i]] = strings[i]; // JPC: TODO: Global strings.\r\n\t\t\t\t\t\t// }\r\n\t\t\t\t\t\t// i18n = i18nplay;\r\n\t            \t\t// Detect custom image.\r\n\t            \t\tif (typeof(custommapconfig) != 'undefined' &&\r\n\t            \t\t\t\tcustommapconfig !== null && \r\n\t            \t\t\t\tcustommapconfig.custombackgroundurl !== null) {\r\n\t    \t\t\t\t\t\tconsole.log('Detecting custom background image dimensions.');\r\n\t            \t\t\t// Detect image size.\r\n\t    \t\t\t\t\t\tvar img = new Image();\r\n\t    \t\t\t\t\t    img.addEventListener(\"load\", function(){\r\n\t    \t\t\t\t\t    \tcustommapconfig.imgwidth =  this.naturalWidth;\r\n\t    \t\t\t\t\t    \tcustommapconfig.imgheight = this.naturalHeight;\r\n\t    \t\t\t\t\t\t\tconsole.log('image is ' + this.naturalWidth + 'x' + this.naturalHeight + 'pixels');\r\n\t    \t\t\t\t\t    \tinitplaytreasurehunt(i18n, cmid, treasurehuntid, playwithoutmoving, groupmode,\r\n\t    \t\t                \t        lastattempttimestamp,\r\n\t    \t\t                \t        lastroadtimestamp, gameupdatetime, tracking, user, custommapconfig);        \r\n\t    \t\t\t\t\t    });\r\n\t    \t\t\t\t\t    img.src = custommapconfig.custombackgroundurl;\r\n\t            \t\t} else {\r\n\t            \t\t\tinitplaytreasurehunt(i18n, cmid, treasurehuntid, playwithoutmoving, groupmode,\r\n\t\t                \t        lastattempttimestamp,\r\n\t\t                \t        lastroadtimestamp, gameupdatetime, tracking, user, custommapconfig);\t            \t\t}\r\n\t            \t\t\r\n\t                // });\r\n\t            } // End of function playtreasurehunt.\r\n\t        };\r\n\t    return init;\r\n\t\t// Initialization function.\r\n\t\tfunction initplaytreasurehunt(strings, cmid, treasurehuntid, playwithoutmoving, groupmode,\r\n\t\t        lastattempttimestamp, lastroadtimestamp, gameupdatetime, tracking, user, custommapconfig){\r\n\t\t\r\n\t\t\t// I18n support.\r\n\t\t\tconsole.log('init player Openlayers');\r\n\t\t\t$.mobile.loading(\"show\");\r\n\t\t\tvar mapprojection = 'EPSG:3857';\r\n\t\t\tvar custombaselayer = null;\r\n\t\t\tvar geographictools = true;\r\n\t\t\tvar defaultzoom = 19;\r\n\t\t\t// Support customized base layers.\r\n\t\t\tif (typeof(custommapconfig) != 'undefined' && custommapconfig !== null) {\r\n\t\t\t\tif (custommapconfig.custombackgroundurl != null) {\r\n\t\t\t\t\tconsole.log('config custom background image');\r\n\t\t\t\t\tvar customimageextent = ol.proj.transformExtent(custommapconfig.bbox, 'EPSG:4326', mapprojection);\r\n\t\t\t\t\tif (!custommapconfig.geographic) {\r\n\t\t\t\t\t\t// Round bbox and scales to allow vectorial SVG rendering. (Maintain ratio.)\r\n\t\t\t\t\t\tvar bboxwidth = customimageextent[2] - customimageextent[0];\r\n\t\t\t\t\t\tvar bboxheight = customimageextent[3] - customimageextent[1];\r\n\t\t\t\t\t\tvar centerwidth = (customimageextent[2] + customimageextent[0]) / 2;\r\n\t\t\t\t\t\tvar centerheight = (customimageextent[3] + customimageextent[1]) / 2;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar ratiorealmap = Math.round(bboxheight / custommapconfig.imgheight);\r\n\t\t\t\t\t\tvar adjwidth = Math.round(custommapconfig.imgwidth * ratiorealmap);\r\n\t\t\t\t\t\tvar adjheight = Math.round(custommapconfig.imgheight * ratiorealmap);\r\n\t\t\t\t\t\tcustomimageextent = [centerwidth - adjwidth/2,\r\n\t\t\t\t\t\t\tcenterheight - adjheight/2,\r\n\t\t\t\t\t\t\tcenterwidth + adjwidth/2,\r\n\t\t\t\t\t\t\tcenterheight + adjheight/2];\r\n\t\t\t\t\t\tdefaultzoom = 5;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcustombaselayer = new ol.layer.Image({\r\n\t\t\t\t\t\t  title : custommapconfig.layername,\r\n\t\t\t\t\t\t  name : custommapconfig.layername,\r\n\t\t\t\t\t\t  type: custommapconfig.layertype,\r\n\t\t\t\t\t      source: new ol.source.ImageStatic({\r\n\t\t\t\t\t        url: custommapconfig.custombackgroundurl,\r\n\t\t\t\t\t        imageExtent: customimageextent,\r\n\t\t\t\t\t      }),\r\n\t\t\t\t\t      opacity: 1.0\r\n\t\t\t\t\t    });\r\n\t\t\t\t} else if (custommapconfig.wmsurl !== null) {\r\n\t\t\t\t\tconsole.log('config custom wms server: ' + custommapconfig.wmsurl);\r\n\t\t\t\t\tvar options = {\r\n\t\t\t\t\t\t\t\tsource: new ol.source.TileWMS({\r\n\t\t\t\t\t\t            url: custommapconfig.wmsurl,\r\n\t\t\t\t\t\t            params: custommapconfig.wmsparams,\r\n\t\t\t\t\t\t          }),\r\n\t\t\t\t\t\t\t\ttype: custommapconfig.layertype,\r\n\t\t\t\t\t\t\t\ttitle: custommapconfig.layername,\r\n\t\t\t\t\t\t\t\tname: custommapconfig.layername,\r\n\t\t\t\t\t        };\r\n\t\t\t\t\tif (custommapconfig.bbox[0] !== null &&\r\n\t\t\t\t\t\t\tcustommapconfig.bbox[1] !== null &&\r\n\t\t\t\t\t\t\tcustommapconfig.bbox[2] !== null &&\r\n\t\t\t\t\t\t\tcustommapconfig.bbox[3] !== null) {\r\n\t\t\t\t\t\tvar customwmsextent = ol.proj.transformExtent(custommapconfig.bbox, 'EPSG:4326', mapprojection);\r\n\t\t\t\t\t\toptions.extent = customwmsextent;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcustombaselayer = new ol.layer.Tile(options);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tgeographictools = custommapconfig.geographic;\r\n\t\t\t}\r\n\t\t\tif (geographictools === false) {\r\n\t\t\t\tconsole.log('geographic tools disabled');\r\n\t\t\t\tplaywithoutmoving = true;\r\n\t\t\t\t$('#autolocate').hide();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t    var parchmenturl = url.imageUrl('success_mark', 'treasurehunt'),\r\n\t\t            failureurl = url.imageUrl('failure_mark', 'treasurehunt'),\r\n\t\t            markerurl = url.imageUrl('my_location', 'treasurehunt'),\r\n\t\t            openStreetMapGeocoder = GeocoderJS.createGeocoder('openstreetmap'),\r\n\t\t            lastsuccessfulstage = {},\r\n\t\t            interval,\r\n\t\t            imgloaded = 0,\r\n\t\t            totalimg = 0,\r\n\t\t            infomsgs = [],\r\n\t\t            attemptshistory = [],\r\n\t\t            changesinattemptshistory = false,\r\n\t\t            changesinlastsuccessfulstage = false,\r\n\t\t            changesinquestionstage = false,\r\n\t\t            fitmap = false,\r\n\t\t            roadfinished = false,\r\n\t\t            available = true,\r\n\t\t            qoaremoved = false;\r\n\t\t    /*-------------------------------Styles-----------------------------------*/\r\n\t\t    var text = new ol.style.Text({\r\n\t\t        textAlign: 'center',\r\n\t\t        scale: 1.3,\r\n\t\t        fill: new ol.style.Fill({\r\n\t\t            color: '#fff'\r\n\t\t        }),\r\n\t\t        stroke: new ol.style.Stroke({\r\n\t\t            color: '#000',\r\n\t\t            width: 3.5\r\n\t\t        })\r\n\t\t    });\r\n\t\t    var selectText = new ol.style.Text({\r\n\t\t        textAlign: 'center',\r\n\t\t        scale: 1.4,\r\n\t\t        fill: new ol.style.Fill({\r\n\t\t            color: '#fff'\r\n\t\t        }),\r\n\t\t        stroke: new ol.style.Stroke({\r\n\t\t            color: '#3399CC',\r\n\t\t            width: 3.5\r\n\t\t        })\r\n\t\t    });\r\n\t\t    var defaultstageStyle = new ol.style.Style({\r\n\t\t        image: new ol.style.Icon({\r\n\t\t            anchor: [0.5, 1],\r\n\t\t            opacity: 1,\r\n\t\t            scale: 0.5,\r\n\t\t            src: parchmenturl\r\n\t\t        }),\r\n\t\t        text: text,\r\n\t\t        zIndex: 'Infinity'\r\n\t\t    });\r\n\t\t    var failstageStyle = new ol.style.Style({\r\n\t\t        image: new ol.style.Icon({\r\n\t\t            anchor: [0.5, 1],\r\n\t\t            opacity: 1,\r\n\t\t            scale: 0.5,\r\n\t\t            src: failureurl\r\n\t\t        }),\r\n\t\t        text: text,\r\n\t\t        zIndex: 'Infinity'\r\n\t\t    });\r\n\t\t    var defaultSelectstageStyle = new ol.style.Style({\r\n\t\t        image: new ol.style.Icon({\r\n\t\t            anchor: [0.5, 1],\r\n\t\t            opacity: 1,\r\n\t\t            scale: 0.75,\r\n\t\t            src: parchmenturl\r\n\t\t        }),\r\n\t\t        text: selectText,\r\n\t\t        zIndex: 'Infinity'\r\n\t\t    });\r\n\t\t    var failSelectstageStyle = new ol.style.Style({\r\n\t\t        image: new ol.style.Icon({\r\n\t\t            anchor: [0.5, 1],\r\n\t\t            opacity: 1,\r\n\t\t            scale: 0.75,\r\n\t\t            src: failureurl\r\n\t\t        }),\r\n\t\t        text: selectText,\r\n\t\t        zIndex: 'Infinity'\r\n\t\t    });\r\n\t\t    var positionFeatureStyle = new ol.style.Style({\r\n\t\t        image: new ol.style.Circle({\r\n\t\t            radius: 6,\r\n\t\t            fill: new ol.style.Fill({\r\n\t\t                color: [0, 0, 0, 1]\r\n\t\t            }),\r\n\t\t            stroke: new ol.style.Stroke({\r\n\t\t                color: [255, 255, 255, 1],\r\n\t\t                width: 2\r\n\t\t            })\r\n\t\t        })\r\n\t\t    });\r\n\t\t    var accuracyFeatureStyle = new ol.style.Style({\r\n\t\t        fill: new ol.style.Fill({\r\n\t\t            color: [255, 255, 255, 0.3]\r\n\t\t        }),\r\n\t\t        stroke: new ol.style.Stroke({\r\n\t\t            color: [0, 0, 0, 0.5],\r\n\t\t            width: 1\r\n\t\t        }),\r\n\t\t        zIndex: -1\r\n\t\t    });\r\n\t\t    var markerFeatureStyle = new ol.style.Style({\r\n\t\t        image: new ol.style.Icon({\r\n\t\t            anchor: [0.5, 1],\r\n\t\t            opacity: 1,\r\n\t\t            scale: 0.35,\r\n\t\t            src: markerurl\r\n\t\t        })\r\n\t\t    });\r\n\t\t    /*-------------------------------Layers-----------------------------------*/\r\n\t\t    var layers = [];\r\n\t\t    var geoJSONFormat = new ol.format.GeoJSON();\r\n\t\t    var source = new ol.source.Vector({\r\n\t\t        projection: 'EPSG:3857'\r\n\t\t    });\r\n\t\t    var attemptslayer = new ol.layer.Vector({\r\n\t\t        source: source,\r\n\t\t        style: style_function\r\n\t\t                /*updateWhileAnimating: true,\r\n\t\t                 updateWhileInteracting: true*/\r\n\t\t    });\r\n\t\t    var aeriallayer = new ol.layer.Tile({\r\n\t\t        visible: false,\r\n\t\t        source: new ol.source.BingMaps({\r\n\t\t            key: 'AmC3DXdnK5sXC_Yp_pOLqssFSaplBbvN68jnwKTEM3CSn2t6G5PGTbYN3wzxE5BR',\r\n\t\t            imagerySet: 'AerialWithLabels',\r\n\t\t            maxZoom: 19\r\n\t\t                    // Use maxZoom 19 to see stretched tiles instead of the BingMaps\r\n\t\t                    // \"no photos at this zoom level\" tiles\r\n\t\t                    // maxZoom: 19.\r\n\t\t        })});\r\n\t\t    aeriallayer.set(\"name\", strings[\"aerialview\"]);\r\n\t\t    var roadlayer = new ol.layer.Tile({\r\n\t\t        source: new ol.source.OSM()\r\n\t\t    });\r\n\t\t    roadlayer.set(\"name\", strings[\"roadview\"]);\r\n\t\t    \r\n\t\t    var layersbase = [];\r\n\t\t    var layersoverlay = [];\r\n\t\t    if ( custommapconfig === null || custommapconfig.onlybase === false) {\r\n\t\t    \tlayersbase = [aeriallayer, roadlayer];\r\n\t\t    }\r\n\t\t    if (custombaselayer !== null) {\r\n\t\t    \tif (custommapconfig.layertype != 'overlay') {\r\n\t\t    \t\tlayersbase.push(custombaselayer);\r\n\t\t    \t} else {\r\n\t\t    \t\tlayersoverlay.push(custombaselayer);\r\n\t\t    \t}\r\n\t\t\t}\r\n\t\t    var layergroup = new ol.layer.Group({layers: layersbase});\r\n\t\t    // All layers hidden except last one.\r\n\t\t    var toplayer = null;\r\n\t\t    layergroup.getLayers().forEach(function (layer) {\r\n\t\t    \tlayer.setVisible(false);\r\n\t\t    \ttoplayer = layer;\r\n\t\t    });\r\n\t\t    toplayer.setVisible(true);\r\n\t\t    \r\n\t\t    var view = new ol.View({\r\n\t\t        center: [0, 0],\r\n\t\t        zoom: 2,\r\n\t\t        minZoom: 2\r\n\t\t    });\r\n\t\t    var select = new ol.interaction.Select({\r\n\t\t        layers: [attemptslayer],\r\n\t\t        style: select_style_function,\r\n\t\t        filter: function (feature, layer) {\r\n\t\t            if (feature.get('stageposition') === 0) {\r\n\t\t                return false;\r\n\t\t            }\r\n\t\t            return true;\r\n\t\t        }\r\n\t\t    });\r\n\t\t    var accuracyFeature = new ol.Feature();\r\n\t\t    accuracyFeature.setProperties({name: 'user_accuracy'});\r\n\t\t    accuracyFeature.setStyle(accuracyFeatureStyle);\r\n\t\t    var positionFeature = new ol.Feature();\r\n\t\t    positionFeature.setProperties({name: 'user_position'});\r\n\t\t    positionFeature.setStyle(positionFeatureStyle);\r\n\t\t    var userPosition = new ol.layer.Vector({\r\n\t\t        source: new ol.source.Vector({\r\n\t\t            features: [accuracyFeature, positionFeature]\r\n\t\t        })\r\n\t\t    });\r\n\t\t    var markerFeature = new ol.Feature();\r\n\t\t    markerFeature.setGeometry(null);\r\n\t\t    markerFeature.setStyle(markerFeatureStyle);\r\n\t\t    var markerVector = new ol.layer.Vector({\r\n\t\t        source: new ol.source.Vector({\r\n\t\t            features: [markerFeature]\r\n\t\t        })\r\n\t\t    });\r\n\t\t    layers.push(layergroup);\r\n\t\t    layers = layers.concat(layersoverlay);\r\n\t\t    layers = layers.concat([ attemptslayer, userPosition, markerVector]);\r\n\t\t    // New Custom zoom.\r\n\t\t    var zoom = new ol.control.Zoom({target: \"navigation\", className: \"custom-zoom\"});\r\n\t\t    var map = new ol.Map({\r\n\t\t        layers: layers,\r\n\t\t        controls: [zoom], //ol.control.defaults({rotate: false, attribution: false}),\r\n\t\t        target: 'mapplay',\r\n\t\t        view: view,\r\n\t\t        loadTilesWhileAnimating: true,\r\n\t\t        loadTilesWhileInteracting: true\r\n\t\t    });\r\n\t\t    map.addInteraction(select);\r\n\t\t    // It initializes the game.\r\n\t\t    renew_source(false, true);\r\n\t\t    // For the game is updated every gameupdatetime seconds.\r\n\t\t    interval = setInterval(function () {\r\n\t\t        renew_source(false, false);\r\n\t\t    }, gameupdatetime);\r\n\t\t    // Initialize the page layers.\r\n\t\t\r\n\t\t    add_layergroup_to_list(layergroup);\r\n\t\t    layersoverlay.forEach(function (overlay) {\r\n\t\t    \tadd_layer_to_list(overlay);\r\n\t\t    });\r\n\t\t    if (tracking && user) {\r\n\t\t        var tracklayergroup = viewgpx.addgpxlayer(map, cmid, treasurehuntid, strings, user, \"trackgroup\");\r\n\t\t        tracklayergroup.set(\"name\", tracklayergroup.get(\"title\"));\r\n\t\t\r\n\t\t        var tracklayer = tracklayergroup.getLayers().item(0);\r\n\t\t        var htmltitle = tracklayer.get(\"title\"); // Has a picture and a link.\r\n\t\t        var plaintitle = htmltitle.substring(htmltitle.indexOf('</a>') + 4);\r\n\t\t        tracklayer.set(\"name\", plaintitle);\r\n\t\t        tracklayer.setVisible(false);\r\n\t\t        add_layer_to_list(tracklayer);\r\n\t\t    }\r\n\t\t    /*-------------------------------Functions-----------------------------------*/\r\n\t\t    function style_function(feature, resolution) {\r\n\t\t        // Get the income level from the feature properties.\r\n\t\t        var stageposition = feature.get('stageposition');\r\n\t\t        if (stageposition === 0) {\r\n\t\t            var fill = new ol.style.Fill({\r\n\t\t                color: 'rgba(255,255,255,0.4)'\r\n\t\t            });\r\n\t\t            var stroke = new ol.style.Stroke({\r\n\t\t                color: '#3399CC',\r\n\t\t                width: 1.25\r\n\t\t            });\r\n\t\t            var styles = new ol.style.Style({\r\n\t\t                image: new ol.style.Circle({\r\n\t\t                    fill: fill,\r\n\t\t                    stroke: stroke,\r\n\t\t                    radius: 5\r\n\t\t                }),\r\n\t\t                fill: fill,\r\n\t\t                stroke: stroke,\r\n\t\t                text: new ol.style.Text({\r\n\t\t                    text: strings[\"startfromhere\"],\r\n\t\t                    textAlign: 'center',\r\n\t\t                    fill: new ol.style.Fill({\r\n\t\t                        color: 'rgb(255,255,255)'\r\n\t\t                    }),\r\n\t\t                    stroke: new ol.style.Stroke({\r\n\t\t                        color: '#3399CC',\r\n\t\t                        width: 5\r\n\t\t                    })\r\n\t\t                })\r\n\t\t            });\r\n\t\t            return [styles];\r\n\t\t        }\r\n\t\t        if (!feature.get('geometrysolved')) {\r\n\t\t// Don't change the scale with the map. This is confusing failstageStyle.getImage().setScale((view.getZoom() / 30));.\r\n\t\t            failstageStyle.getText().setText('' + stageposition);\r\n\t\t            return [failstageStyle];\r\n\t\t        }\r\n\t\t// Don't change the scale with the map. This is confusing  defaultstageStyle.getImage().setScale((view.getZoom() / 100));.\r\n\t\t        defaultstageStyle.getText().setText('' + stageposition);\r\n\t\t        return [defaultstageStyle];\r\n\t\t    }\r\n\t\t    function select_style_function(feature, resolution) {\r\n\t\t        var stageposition = feature.get('stageposition');\r\n\t\t        if (!feature.get('geometrysolved')) {\r\n\t\t            failSelectstageStyle.getText().setText('' + stageposition);\r\n\t\t            return [failSelectstageStyle];\r\n\t\t        }\r\n\t\t        defaultSelectstageStyle.getText().setText('' + stageposition);\r\n\t\t        return [defaultSelectstageStyle];\r\n\t\t    }\r\n\t\t    function validateposition() {\r\n\t\t        if (playwithoutmoving && markerFeature.getGeometry() === null) {\r\n\t\t            toast(strings[\"nomarks\"]);\r\n\t\t        } else {\r\n\t\t            renew_source(true, false);\r\n\t\t        }\r\n\t\t    }\r\n\t\t    function autocentermap() {\r\n\t\t        position = geolocation.getPosition();\r\n\t\t        fly_to(map, position);\r\n\t\t    }\r\n\t\t    function fly_to(map, point, extent) {\r\n\t\t        var duration = 700;\r\n\t\t        var view = map.getView();\r\n\t\t        if (extent) {\r\n\t\t            view.fit(extent, {\r\n\t\t                duration: duration\r\n\t\t            });\r\n\t\t        } else {\r\n\t\t            view.animate({\r\n\t\t                zoom: defaultzoom,\r\n\t\t                center: point,\r\n\t\t                duration: duration\r\n\t\t            });\r\n\t\t        }\r\n\t\t    }\r\n\t\t    /**\r\n\t\t     * Updates the model of the game.\r\n\t\t     * Notifies a new location for validation or a new answer to a question\r\n\t\t     * @param {boolean} location requests a location validation\r\n\t\t     * @param {boolean} initialize\r\n\t\t     * @param {int} selectedanswerid submits an answer to a question\r\n\t\t     * @param {string} qrtext submits a text scanned from a QRCode\r\n\t\t     * @returns {undefined}\r\n\t\t     */\r\n\t\t    function renew_source(location, initialize, selectedanswerid, qrtext) {\r\n\t\t        // var position holds the potition to be evaluated. undef if no evaluation requested\r\n\t\t        var position;\r\n\t\t        var currentposition;\r\n\t\t        var coordinates;\r\n\t\t        var answerid;\r\n\t\t        \r\n\t\t        if (playwithoutmoving) {\r\n\t\t            coordinates = markerFeature.getGeometry();\r\n\t\t        } else {\r\n\t\t            coordinates = positionFeature.getGeometry();\r\n\t\t        }\r\n\t\t        if (coordinates) {\r\n\t\t            currentposition = geoJSONFormat.writeGeometryObject(coordinates, {\r\n\t\t                dataProjection: 'EPSG:4326',\r\n\t\t                featureProjection: 'EPSG:3857'\r\n\t\t            });\r\n\t\t        }\r\n\t\t        if (selectedanswerid) {\r\n\t\t            $.mobile.loading(\"show\");\r\n\t\t            answerid = selectedanswerid;\r\n\t\t        }\r\n\t\t        if (location) {\r\n\t\t            position = currentposition;\r\n\t\t            $.mobile.loading(\"show\");\r\n\t\t\t\t}\t\t\t\t\r\n\t\t        var geojson = ajax.call([{\r\n\t\t                methodname: 'mod_treasurehunt_user_progress',\r\n\t\t                args: {userprogress: {\r\n\t\t                        treasurehuntid: treasurehuntid,\r\n\t\t                        attempttimestamp: lastattempttimestamp,\r\n\t\t                        roadtimestamp: lastroadtimestamp,\r\n\t\t                        playwithoutmoving: playwithoutmoving,\r\n\t\t                        groupmode: groupmode,\r\n\t\t                        initialize: initialize,\r\n\t\t                        location: position,\r\n\t\t                        currentposition: (tracking && !playwithoutmoving) ? currentposition : undefined, // only for tracking in mobility.\r\n\t\t                        selectedanswerid: answerid,\r\n\t\t                        qoaremoved: qoaremoved,\r\n\t\t                        qrtext: qrtext}\r\n\t\t                }\r\n\t\t            }]);\r\n\t\t        geojson[0].done(function (response) {\r\n\t\t            var body = '';\r\n\t\t            qoaremoved = response.qoaremoved;\r\n\t\t            roadfinished = response.roadfinished;\r\n\t\t\t\t\tavailable = response.available;\r\n\t\t\t\t\t$.mobile.loading(\"hide\");\r\n\t\t            // If I have sent a location or an answer I print out whether it is correct or not.\r\n\t\t            if (location || selectedanswerid) {\r\n\t\t                if (response.status !== null && available) {\r\n\t\t                    console.log(response.status.msg);\r\n\t\t                }\r\n\t\t            }\r\n\t\t            if (response.qrexpected) {\r\n\t\t                $('#validateqr').show();\r\n\t\t            } else {\r\n\t\t                $('#validateqr').hide();\r\n\t\t            }\r\n\t\t            // If you change the game mode (mobile or static).\r\n\t\t            if (playwithoutmoving != response.playwithoutmoving) {\r\n\t\t                playwithoutmoving = response.playwithoutmoving;\r\n\t\t                if (!playwithoutmoving) {\r\n\t\t                    markerFeature.setGeometry(null);\r\n\t\t                }\r\n\t\t            }\r\n\t\t            // If you change the group mode. \r\n\t\t            if (groupmode != response.groupmode) {\r\n\t\t                groupmode = response.groupmode;\r\n\t\t            }\r\n\t\t            if (lastattempttimestamp !== response.attempttimestamp || lastroadtimestamp\r\n\t\t                    !== response.roadtimestamp || initialize || !available) {\r\n\t\t                lastattempttimestamp = response.attempttimestamp;\r\n\t\t                lastroadtimestamp = response.roadtimestamp;\r\n\t\t                if (response.historicalattempts.length > 0) {\r\n\t\t                    attemptshistory = response.historicalattempts;\r\n\t\t                    changesinattemptshistory = true;\r\n\t\t                }\r\n\t\t                // Compruebo si es distinto de null, lo que indica que se ha actualizado.\r\n\t\t                if (response.attempts || response.firststagegeom) {\r\n\t\t                    source.clear();\r\n\t\t                    if (response.firststagegeom) {\r\n\t\t                        source.addFeatures(geoJSONFormat.readFeatures(response.firststagegeom, {\r\n\t\t                            'dataProjection': \"EPSG:4326\",\r\n\t\t                            'featureProjection': \"EPSG:3857\"\r\n\t\t                        }));\r\n\t\t                    }\r\n\t\t                    if (response.attempts.features.length > 0) {\r\n\t\t                        source.addFeatures(geoJSONFormat.readFeatures(response.attempts, {\r\n\t\t                            'dataProjection': \"EPSG:4326\",\r\n\t\t                            'featureProjection': \"EPSG:3857\"\r\n\t\t                        }));\r\n\t\t                    }\r\n\t\t                }\r\n\t\t                // Check if it exists, which indicates that it has been updated.\r\n\t\t                if (response.lastsuccessfulstage) {\r\n\t\t                    lastsuccessfulstage = response.lastsuccessfulstage;\r\n\t\t                    changesinlastsuccessfulstage = true;\r\n\t\t                    // If the stage is not solved I will notify you that there are changes.\r\n\t\t                    if (lastsuccessfulstage.question !== '') {\r\n\t\t                        changesinquestionstage = true;\r\n\t\t                        $('#validatelocation').hide();\r\n\t\t                        $('#question_button').show();\r\n\t\t                    } else if (!lastsuccessfulstage.activitysolved) {\r\n\t\t                        $('#validatelocation').hide();\r\n\t\t                        $('#question_button').show();\r\n\t\t                    } else {\r\n\t\t                        $('#validatelocation').show();\r\n\t\t                        $('#question_button').hide();\r\n\t\t                    }\r\n\t\t                }\r\n\t\t                // Check if it is the first geometry or it is being initialized and center the map.\r\n\t\t                if (response.firststagegeom || initialize) {\r\n\t\t                    fitmap = true;\r\n\t\t                }\r\n\t\t                // Check the page we're on.\r\n\t\t\t\t\t\tvar pageId = $.mobile.pageContainer.pagecontainer('getActivePage').prop(\"id\");\r\n\t\t\t\t\t\t// Update the page model wherever the page we are.\r\n\t\t\t\t\t\tset_lastsuccessfulstage();\r\n\t\t\t\t\t\tfit_map_to_source();\r\n\t\t\t\t\t\tset_question();\r\n\t\t                if (pageId === 'mappage') {\r\n\t\t\t\t\t\t\t// Nothing special.\r\n\t\t                } else if (pageId === 'historypage') {\r\n\t\t\t\t\t\t\tset_attempts_history();\r\n\t\t                } else if (pageId === 'questionpage') {\r\n\t\t                    if (lastsuccessfulstage.question === '') {\r\n\t\t                        $.mobile.pageContainer.pagecontainer(\"change\", \"#mappage\");\r\n\t\t                    } else {\r\n\t\t                        $.mobile.resetActivePageHeight();\r\n\t\t                    }\r\n\t\t                }\r\n\t\t            }\r\n\t\t            if (response.infomsg.length > 0) {\r\n\t\t                infomsgs.forEach(function (msg) {\r\n\t\t                    body += '<p>' + msg + '</p>';\r\n\t\t                });\r\n\t\t                response.infomsg.forEach(function (msg) {\r\n\t\t                    infomsgs.push(msg);\r\n\t\t                    body += '<p>' + msg + '</p>';\r\n\t\t                });\r\n\t\t                create_popup('displayupdates', strings[\"updates\"], body);\r\n\t\t            }\r\n\t\t            if (!roadfinished) {\r\n\t\t                $('#roadended').hide();\r\n\t\t            }\r\n\t\t            if (roadfinished || !available) {\r\n\t\t                $('#validatelocation').hide();\r\n\t\t                $('#question_button').hide();\r\n\t\t                $('#roadended').show();\r\n\t\t                markerFeature.setGeometry(null);\r\n\t\t                playwithoutmoving = false;\r\n\t\t                clearInterval(interval);\r\n\t\t                $(\"#mapplay\").css('opacity', '0.8');\r\n\t\t            }\r\n\t\t        }).fail(function (error) {\r\n\t\t            console.log(error);\r\n\t\t            create_popup('displayerror', strings['error'], error.message);\r\n\t\t            clearInterval(interval);\r\n\t\t        });\r\n\t\t    }\r\n\t\t    function fit_map_to_source() {\r\n\t\t        if (fitmap) {\r\n\t\t            var features = source.getFeatures();\r\n\t\t            if (features.length === 1 && features[0].getGeometry() instanceof ol.geom.Point) {\r\n\t\t                fly_to(map, features[0].getGeometry().getCoordinates());\r\n\t\t            } else {\r\n\t\t                fly_to(map, null, source.getExtent());\r\n\t\t            }\r\n\t\t\r\n\t\t            fitmap = false;\r\n\t\t        }\r\n\t\t    }\r\n\t\t    function truncate( n, useWordBoundary ){\r\n\t\t        if (this.length <= n) { return this; }\r\n\t\t        var subString = this.substr(0, n-1);\r\n\t\t        return (useWordBoundary \r\n\t\t           ? subString.substr(0, subString.lastIndexOf(' ')) \r\n\t\t           : subString) + \"&hellip\";\r\n\t\t    };\r\n\t\t    function set_lastsuccessfulstage() {\r\n\t\t        if (changesinlastsuccessfulstage) {\r\n\t\t            $(\"#lastsuccessfulstagename\").text(strings['stage'] + ':' + lastsuccessfulstage.name);\r\n\t\t            $(\"#lastsuccesfulstagepos\").text(lastsuccessfulstage.position +\r\n\t\t                    \" / \" + lastsuccessfulstage.totalnumber);\r\n\t\t            var maxchars = 100;\r\n\t\t            var briefing;\r\n\t\t            // Clean color styles from clue.\r\n\t\t            lastsuccessfulstage.clue = lastsuccessfulstage.clue.replace(/color/gm, 'color-disabled');\r\n\t\t            $(\"#lastsuccessfulstageclue\").html(lastsuccessfulstage.clue);\r\n\t\t            var clueplaintext = lastsuccessfulstage.clue.replace(/<(?:.|\\n)*?>/gm, '');\r\n\t\t            if (clueplaintext.length > maxchars*2 ) {\r\n\t\t            \t$(\"#lastsuccessfulstageclue\").truncate(maxchars*2);\r\n\t\t            \tbriefing = ' <a href=\"#historypage\" data-transition=\"none\" class=\"ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-btn-inline ui-icon-info ui-btn-icon-notext\"></a> ';\r\n\t\t            \t$(\"#lastsuccessfulstageclue\").append(briefing);\r\n\t\t            } else {\r\n\t\t            \tbriefing = lastsuccessfulstage.clue;\r\n\t\t            }\r\n\t\t            \r\n\t\t            $(\"#lastsuccessfulstagename2\").text(lastsuccessfulstage.name);\r\n\t\t            $(\"#lastsuccesfulstagepos2\").text(lastsuccessfulstage.position +\r\n\t\t                    \" / \" + lastsuccessfulstage.totalnumber);\r\n\t\t            $(\"#lastsuccessfulstageclue2\").html(lastsuccessfulstage.clue);\r\n\r\n\t\t            if (lastsuccessfulstage.question !== '') {\r\n\t\t                $(\"#lastsuccessfulstageclue\").append(\"<a href='#questionpage' \" +\r\n\t\t                        \"data-transition='none' class='ui-btn ui-shadow ui-corner-all \" +\r\n\t\t                        \"ui-btn-icon-left ui-btn-inline ui-mini ui-icon-comment'>\"\r\n\t\t                        + strings['question']\r\n\t\t                        + \"</a>\");\r\n\t\t                $(\"#lastsuccessfulstageclue2\").append(\"<a href='#questionpage' \" +\r\n\t\t                        \"data-transition='none' class='ui-btn ui-shadow ui-corner-all \" +\r\n\t\t                        \"ui-btn-icon-left ui-btn-inline ui-mini ui-icon-comment'>\"\r\n\t\t                        + strings['question']\r\n\t\t                        + \"</a>\");\r\n\t\t            }\r\n\t\t            $(\"#collapsibleset\").collapsibleset(\"refresh\");\r\n\t\t            $(\"#infopanel\").panel(\"open\");\r\n\t\t            $(\"#lastsuccessfulstage\").collapsible(\"expand\");\r\n\t\t            changesinlastsuccessfulstage = false;\r\n\t\t        }\r\n\t\t    }\r\n\t\t    function set_question() {\r\n\t\t        if (changesinquestionstage) {\r\n\t\t        \t// Clean color tag.\r\n\t\t        \tlastsuccessfulstage.question = lastsuccessfulstage.question.replace(/color/gm, 'color-disabled');\r\n\r\n\t\t            $('#questionform').html(\"<legend>\" + lastsuccessfulstage.question + \"</legend>\");\r\n\t\t            var counter = 1;\r\n\t\t            $.each(lastsuccessfulstage.answers, function (key, answer) {\r\n\t\t                var id = 'answer' + counter;\r\n\t\t\t        \t// Clean color tag.\r\n\t\t                answer.answertext = answer.answertext.replace(/color/gm, 'color-disabled');\r\n\r\n\t\t                $('#questionform').append('<input type=\"radio\" name=\"answers\" id=\"' + id + '\"value=\"'\r\n\t\t                        + answer.id + '\">' +\r\n\t\t                        '<label for=\"' + id + '\">' + answer.answertext + '</label>');\r\n\t\t                counter++;\r\n\t\t            });\r\n\t\t\t\t   // This decoration renders with problems.\r\n\t\t\t\t   // $('#questionform').enhanceWithin().controlgroup(\"refresh\");\r\n\t\t            changesinquestionstage = false;\r\n\t\t        }\r\n\t\t\r\n\t\t    }\r\n\t\t    function set_attempts_history() {\r\n\t\t        // Compruebo si ha habido cambios desde la ultima vez\r\n\t\t        if (changesinattemptshistory) {\r\n\t\t            var $historylist = $(\"#historylist\");\r\n\t\t            // Lo reinicio\r\n\t\t            $historylist.html('');\r\n\t\t            changesinattemptshistory = false;\r\n\t\t            if (attemptshistory.length === 0) {\r\n\t\t                $(\"<li>\" + strings[\"noattempts\"] + \"</li>\").appendTo($historylist);\r\n\t\t            } else {\r\n\t\t                // Anado cada intento\r\n\t\t                attemptshistory.forEach(function (attempt) {\r\n\t\t                    $(\"<li><span class='ui-btn-icon-left \"\r\n\t\t                            + (attempt.penalty ? 'ui-icon-delete failedattempt' : 'ui-icon-check successfulattempt')\r\n\t\t                            + \"' style='position:relative'></span>\" + attempt.string + \"</li>\")\r\n\t\t                            .appendTo(\r\n\t\t                                    $historylist);\r\n\t\t                });\r\n\t\t            }\r\n\t\t            $historylist.listview(\"refresh\");\r\n\t\t            $historylist.trigger(\"updatelayout\");\r\n\t\t        }\r\n\t\t    }\r\n\t\t    function add_layer_to_list(layer) {\r\n\t\t        var item = $('<li>', {\r\n\t\t            \"data-icon\": \"check\",\r\n\t\t            \"class\": layer.getVisible() ? \"checked\" : \"unchecked\"\r\n\t\t        })\r\n\t\t                .append($('<a />', {\r\n\t\t                    text: layer.get(\"name\"),\r\n\t\t                    href: \"#mappage\"\r\n\t\t                })\r\n\t\t                        .click(function () {\r\n\t\t                            layer.setVisible(!layer.getVisible());\r\n\t\t                        })\r\n\t\t                        );\r\n\t\t        layer.on('change:visible', function () {\r\n\t\t            $(item).toggleClass('checked unchecked');\r\n\t\t        });\r\n\t\t        item.insertAfter('#baseLayer');\r\n\t\t    }\r\n\r\n\t\t    function add_layergroup_to_list(layergroup) {\r\n\t\t        layergroup.getLayers().forEach(function (layer) {\r\n\t\t            var item = $('<li>', {\r\n\t\t                \"data-icon\": \"check\",\r\n\t\t                \"class\": layer.getVisible() ? \"checked\" : \"unchecked\"\r\n\t\t            })\r\n\t\t                    .append($('<a />', {\r\n\t\t                        text: layer.get(\"name\"),\r\n\t\t                        href: \"#mappage\"\r\n\t\t                    })\r\n\t\t                            .click(function () {\r\n\t\t                                layergroup.getLayers().forEach(function (l) {\r\n\t\t                                    if (l === layer) {\r\n\t\t                                        l.setVisible(true);\r\n\t\t                                    } else {\r\n\t\t                                        l.setVisible(false);\r\n\t\t                                    }\r\n\t\t                                });\r\n\t\t                            })\r\n\t\t                            );\r\n\t\t            layer.on('change:visible', function () {\r\n\t\t                $(item).toggleClass('checked unchecked');\r\n\t\t            });\r\n\t\t            item.insertAfter('#baseLayer');\r\n\t\t        });\r\n\t\t\r\n\t\t    }\r\n\t\t    /**\r\n\t\t     * Geolocation component\r\n\t\t     * @type ol.Geolocation\r\n\t\t     */\r\n\t\t    var geolocation = new ol.Geolocation(/** @type {olx.GeolocationOptions} */({\r\n\t\t        projection: view.getProjection(),\r\n\t\t        trackingOptions: {\r\n\t\t            enableHighAccuracy: true,\r\n\t\t            maximumAge: 0,\r\n\t\t            timeout: 10000\r\n\t\t        }\r\n\t\t    }));\r\n\t\t    /*-------------------------------Events-----------------------------------*/\r\n\t\t    geolocation.on('change:position', function () {\r\n\t\t        var coordinates = this.getPosition();\r\n\t\t        positionFeature.setGeometry(coordinates ? new ol.geom.Point(coordinates) : null);\r\n\t\t        // The map must be re-centered in the new position\r\n\t\t        if (this.get(\"center\")) {\r\n\t\t            fly_to(map, coordinates);\r\n\t\t            this.setProperties({\"center\": false}); // Disable center request. Deprecated.\r\n\t\t        }\r\n\t\t        // the new position must be evaluated\r\n\t\t        if (this.get(\"validate_location\")) {\r\n\t\t            renew_source(true, false);\r\n\t\t            this.setProperties({\"validate_location\": false}); // Disable validate_location request. Deprecated.\r\n\t\t        }\r\n\t\t        $.mobile.loading(\"hide\");\r\n\t\t    });\r\n\t\t    geolocation.on('change:accuracyGeometry', function () {\r\n\t\t        accuracyFeature.setGeometry(this.getAccuracyGeometry());\r\n\t\t        $.mobile.loading(\"hide\");\r\n\t\t    });\r\n\t\t    var trackinggeolocationwarndispatched = false;\r\n\t\t    geolocation.on('error', function (error) {\r\n\t\t        $.mobile.loading(\"hide\");\r\n\t\t        geolocation.setProperties({\"user_denied\": true});\r\n\t\t        toast(error.message);\r\n\t\t        if (error.code == error.PERMISSION_DENIED && tracking && !playwithoutmoving && trackinggeolocationwarndispatched == false) {\r\n\t\t            setTimeout(function () {\r\n\t\t                $('#popupgeoloc').popup(\"open\", {positionTo: \"window\"});\r\n\t\t                trackinggeolocationwarndispatched = true;\r\n\t\t            }, 500);\r\n\t\t        }\r\n\t\t    });\r\n\t\t    geolocation.setTracking(tracking); // Start position tracking.\r\n\t\t\r\n\t\t    select.on(\"select\", function (features) {\r\n\t\t        if (features.selected.length === 1) {\r\n\t\t            if (lastsuccessfulstage.position === features.selected[0].get('stageposition')\r\n\t\t                    && features.selected[0].get('geometrysolved') && !roadfinished && available) {\r\n\t\t                $(\"#infopanel\").panel(\"open\");\r\n\t\t                $(\"#lastsuccessfulstage\").collapsible(\"expand\");\r\n\t\t            } else {\r\n\t\t                var title, stagename = features.selected[0].get('name'),\r\n\t\t                        stageclue = features.selected[0].get('clue'),\r\n\t\t                        info = features.selected[0].get('info'), body = '';\r\n\t\t                if (features.selected[0].get('geometrysolved'))\r\n\t\t                {\r\n\t\t                    if (stagename && stageclue) {\r\n\t\t                        title = strings[\"stageovercome\"];\r\n\t\t                        body = get_block_text(strings[\"stagename\"], stagename);\r\n\t\t                        body += get_block_text(strings[\"stageclue\"], stageclue);\r\n\t\t                    } else {\r\n\t\t                        title = strings[\"discoveredlocation\"];\r\n\t\t                    }\r\n\t\t                } else {\r\n\t\t                    title = strings[\"failedlocation\"];\r\n\t\t                }\r\n\t\t                if (info) {\r\n\t\t                    body += '<p>' + info + '</p>';\r\n\t\t                }\r\n\t\t                create_popup('infostage', title, body);\r\n\t\t            }\r\n\t\t        }\r\n\t\t    });\r\n\t\t    map.on('click', function (evt) {\r\n\t\t        var hasFeature = false;\r\n\t\t        map.forEachFeatureAtPixel(map.getEventPixel(evt.originalEvent), function (feature, layer) {\r\n\t\t            if (feature.get('stageposition') === 0 ||\r\n\t\t            \t\tfeature.get('name') === \"user_position\" ||\r\n\t\t            \t\tfeature.get('name') === \"user_accuracy\") {\r\n\t\t                return false;\r\n\t\t            }\r\n\t\t            hasFeature = true;\r\n\t\t        });\r\n\t\t        if (playwithoutmoving && !hasFeature) {\r\n\t\t            var coordinates = map.getEventCoordinate(evt.originalEvent);\r\n\t\t            markerFeature.setGeometry(coordinates ?\r\n\t\t                    new ol.geom.Point(coordinates) : null);\r\n\t\t        }\r\n\t\t    });\r\n\t\t    $(\"#autocomplete\").on(\"filterablebeforefilter\", function (e, data) {\r\n\t\t    \tif (!geographictools) {\r\n\t\t    \t\treturn;\r\n\t\t    \t}\r\n\t\t        var $ul = $(this),\r\n\t\t                value = $(data.input).val(),\r\n\t\t                html = \"\";\r\n\t\t        $ul.html(html);\r\n\t\t        if (value && value.length > 2) {\r\n\t\t            $.mobile.loading(\"show\", {\r\n\t\t                text: strings['searching'],\r\n\t\t                textVisible: true,\r\n\t\t                theme: \"b\"});\r\n\t\t            openStreetMapGeocoder.geocode(value, function (response) {\r\n\t\t                if (response[0] === false) {\r\n\t\t                    $ul.html(\"<li data-filtertext='\" + value + \"'>\" + strings[\"noresults\"] + \"</li>\");\r\n\t\t                } else {\r\n\t\t                    $.each(response, function (i, place) {\r\n\t\t                        $(\"<li data-filtertext='\" + value + \"'>\")\r\n\t\t                                .hide().append($(\"<a href='#'>\").text(place.totalName)\r\n\t\t                                .append($(\"<p>\").text(place.type))\r\n\t\t                                ).appendTo($ul).click(function () {\r\n\t\t                            var extent = [];\r\n\t\t                            extent[0] = parseFloat(place.boundingbox[2]);\r\n\t\t                            extent[1] = parseFloat(place.boundingbox[0]);\r\n\t\t                            extent[2] = parseFloat(place.boundingbox[3]);\r\n\t\t                            extent[3] = parseFloat(place.boundingbox[1]);\r\n\t\t                            extent = ol.proj.transformExtent(extent, 'EPSG:4326', 'EPSG:3857');\r\n\t\t                            fly_to(map, null, extent);\r\n\t\t                            $('#searchpanel').panel(\"close\");\r\n\t\t                        }).show();\r\n\t\t                    });\r\n\t\t                }\r\n\t\t                $ul.listview(\"refresh\");\r\n\t\t                $ul.trigger(\"updatelayout\");\r\n\t\t                $.mobile.loading(\"hide\");\r\n\t\t            });\r\n\t\t        }\r\n\t\t    });\r\n\t\t    // Scroll to collapsible expanded\r\n\t\t    $(\"#infopanel\").on(\"collapsibleexpand\", \"[data-role='collapsible']\", function (event, ui) {\r\n\t\t        var innerinfopanel = $(\"#infopanel .ui-panel-inner\");\r\n\t\t        innerinfopanel.animate({\r\n\t\t            scrollTop: parseInt($(this).offset().top - innerinfopanel.offset().top\r\n\t\t                    + innerinfopanel.scrollTop())\r\n\t\t        }, 500);\r\n\t\t    });\r\n\t\t    // Set a max-height to make large images shrink to fit the screen.\r\n\t\t    $(document).on(\"popupbeforeposition\", function () {\r\n\t\t        var maxHeight = $(window).height() - 200 + \"px\";\r\n\t\t        $('.ui-popup [data-role=\"content\"]').css(\"max-height\", maxHeight);\r\n\t\t    });\r\n\t\t    // Remove the popup after it has been closed to manage DOM size.\r\n\t\t    $(document).on(\"popupafterclose\", \".ui-popup:not(#QRdialog):not(#popupdialog):not(#popupgeoloc)\", function () {\r\n\t\t        $(this).remove();\r\n\t\t        select.getFeatures().clear();\r\n\t\t    });\r\n\t\t\r\n\t\t    $(document).on(\"click\", \"#acceptupdates\", function () {\r\n\t\t        infomsgs = [];\r\n\t\t    });\r\n\t\t    // Redraw map.\r\n\t\t    $(window).on(\"pagecontainershow resize\", function (event, ui) {\r\n\t\t        $.mobile.resetActivePageHeight();\r\n\t\t        var pageId = $.mobile.pageContainer.pagecontainer('getActivePage').prop(\"id\");\r\n\t\t        if (pageId === 'mappage') {\r\n\t\t            if (event.type === \"resize\") {\r\n\t\t                setTimeout(function () {\r\n\t\t                    map.updateSize();\r\n\t\t                }, 200);\r\n\t\t            } else {\r\n\t\t                map.updateSize();\r\n\t\t                //set_lastsuccessfulstage();\r\n\t\t                fit_map_to_source();\r\n\t\t            }\r\n\t\t        } else if (pageId === 'historypage') {\r\n\t\t            if (event.type === 'pagecontainershow') {\r\n\t\t                set_attempts_history();\r\n\t\t            }\r\n\t\t        } else if (pageId === 'questionpage') {\r\n\t\t            if (event.type === 'pagecontainershow') {\r\n\t\t                if (lastsuccessfulstage.question === '') {\r\n\t\t                    $.mobile.pageContainer.pagecontainer(\"change\", \"#mappage\");\r\n\t\t                } else {\r\n\t\t                    set_question();\r\n\t\t                }\r\n\t\t            }\r\n\t\t        }\r\n\t\t\r\n\t\t    });\r\n\t\t    //Buttons events.\r\n\t\t    if (geographictools) {\r\n\t\t\t    $('#autolocate').on('click', function () {\r\n\t\t\t        if (geolocation.get(\"user_denied\")) {\r\n\t\t\t            $('#popupgeoloc').popup(\"open\", {positionTo: \"window\"});\r\n\t\t\t        } else {\r\n\t\t\t            autocentermap(true);\r\n\t\t\t        }\r\n\t\t\t    });\r\n\t\t\t}\r\n\t\t    $('#infopanel').panel({beforeclose: function () {\r\n\t\t            select.getFeatures().clear();\r\n\t\t        }\r\n\t\t    });\r\n\t\t    $('#sendLocation').on('click', function () {\r\n\t\t        validateposition(true);\r\n\t\t    });\r\n\t\t    $('#sendAnswer').on('click', function (event) {\r\n\t\t        // Selecciono la respuesta.\r\n\t\t        var selected = $(\"#questionform input[type='radio']:checked\");\r\n\t\t        if (!available) {\r\n\t\t            event.preventDefault();\r\n\t\t            toast(strings['timeexceeded']);\r\n\t\t        } else {\r\n\t\t            if (selected.length === 0) {\r\n\t\t                event.preventDefault();\r\n\t\t                toast(strings['noanswerselected']);\r\n\t\t            } else {\r\n\t\t                renew_source(false, false, selected.val());\r\n\t\t            }\r\n\t\t        }\r\n\t\t\r\n\t\t    });\r\n\t\t    $('#validatelocation').on('click', function (event) {\r\n\t\t        if (roadfinished) {\r\n\t\t            event.preventDefault();\r\n\t\t            toast(strings['huntcompleted']);\r\n\t\t            return;\r\n\t\t        }\r\n\t\t        if (!available) {\r\n\t\t            event.preventDefault();\r\n\t\t            toast(strings['timeexceeded']);\r\n\t\t            return;\r\n\t\t        }\r\n\t\t        if (lastsuccessfulstage.question !== '') {\r\n\t\t            event.preventDefault();\r\n\t\t            toast(strings['answerwarning']);\r\n\t\t            $(\"#infopanel\").panel(\"open\");\r\n\t\t            return;\r\n\t\t        }\r\n\t\t        if (!lastsuccessfulstage.activitysolved) {\r\n\t\t            event.preventDefault();\r\n\t\t            toast(strings['activitytoendwarning']);\r\n\t\t            $(\"#infopanel\").panel(\"open\");\r\n\t\t            return;\r\n\t\t        }\r\n\t\t    });\r\n\t\t    /*-------------------------------Initialize page -------------*/\r\n\t\t    if ($.mobile.autoInitializePage === false) {\r\n\t\t        $(\"#container\").show();\r\n\t\t        $(\"#loader\").remove();\r\n\t\t        $.mobile.initializePage();\r\n\t\t        var viewport = document.querySelector(\"meta[name=viewport]\");\r\n\t\t        viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, ' +\r\n\t\t                'maximum-scale=1.0, user-scalable=0');\r\n//\t\t        $(\"#infopanel .ui-panel-inner\").niceScroll();\r\n\t\t\r\n\t\t        $(\"#QRdialog\").popup({\r\n\t\t            beforeposition: function (event, ui) {\r\n//\t\t                $(this).css({\r\n//\t\t                    width: window.innerWidth * 0.8,\r\n//\t\t                    height: window.innerHeight * 0.8,\r\n//\t\t                    top: 0,\r\n//\t\t                    left: 0\r\n//\t\t                });\r\n\t\t            \t$(this).width(window.innerWidth * 0.9);\r\n\t\t            \t$(this).height(window.innerHeight * 0.9);\r\n\t\t               \r\n\t\t            },\r\n\t\t            afteropen: function (event, ui) {\r\n\t\t            \tvar contentdiv =  $(this).find(\"div[data-role='content']\").first();\r\n\t\t            \tvar headerdiv = $(this).find(\"div[data-role='header']\").first();\r\n\t\t            \tvar padding = parseInt(contentdiv.css('padding-top')) + parseInt(contentdiv.css('padding-bottom'));\r\n\t\t            \tcontentdiv.css('max-height', \"1000px\");\r\n\t\t            \t$('#previewVideoDiv').width($(this).width() - padding)\r\n\t                \t\t\t\t\t\t  .height($(this).height() \r\n\t                \t\t\t\t\t\t\t\t  - $('#previewQRbuttons').height() \r\n\t                \t\t\t\t\t\t\t\t  - headerdiv.height()\r\n\t                \t\t\t\t\t\t\t\t  - padding * 2 );\r\n\t\t            \t$('#previewQRvideo').show(); \r\n\t\t\t\tloadQR(qrReaded, qrReport);\r\n\t\t            },\r\n\t\t            afterclose: function (event, ui) {\r\n\t\t                unloadQR(qrReport);\r\n\t\t            }\r\n\t\t        });\r\n\t\t    }\r\n\t\t    $(\"#nextcamera\").on('click', function() {\r\n\t\t    \tif (detectedCameras !== null) {\r\n\t\t\t    \tvar nextcam = getnextwebCam();\r\n\t\t\t    \ttoast('Give access to:' + detectedCameras[nextcam].name);\r\n\t\t    \t}\r\n\t\t    \tsetnextwebcam(qrReport);\r\n\t\t    });\r\n\t\t    // Scan QR.\r\n\t\t    function qrReaded(value) {\r\n\t\t        close_popup($('#QRdialog'));\r\n\t\t        console.log(value);\r\n\t\t        toast(\"QR code readed: \" + value);\r\n\t\t        renew_source(false, false, null, value);\r\n\t\t    }\r\n\t\t    function qrReport(message) {\r\n\t\t    \tif (typeof(message) == 'string') {\r\n\t\t    \t\t$('#errorQR').text(message);\t\t    \t\t\r\n\t\t    \t} else {\r\n\t\t    \t\tif (message.cameras[message.camera].name !== null) {\r\n\t\t    \t\t\t$('#errorQR').text(message.cameras[message.camera].name);\r\n\t\t    \t\t}\r\n\t\t    \t\t// hide/show next camera button.\r\n\t\t    \t\tif (message.cameras.length > 1) {\r\n\t\t    \t\t\t$('#nextcamera').show();\r\n\t\t    \t\t} else {\r\n\t\t    \t\t\t$('#nextcamera').hide();\r\n\t\t    \t\t}\r\n\t\t    \t}\r\n\t\t    }\r\n\t\t    /*-------------------------------Help functions -------------*/\r\n\t\t    function toast(msg) {\r\n\t\t        if ($(\".toast\").length > 0) {\r\n\t\t            setTimeout(function () {\r\n\t\t                toast(msg);\r\n\t\t            }, 2500);\r\n\t\t        } else {\r\n\t\t            $(\"<div class='ui-loader ui-overlay-shadow  ui-corner-all toast'>\" +\r\n\t\t                    \"<p>\" + msg + \"</p></div>\")\r\n\t\t                    .css({left: ($(window).width() - 284) / 2,\r\n\t\t                        top: $(window).height() / 2})\r\n\t\t                    .appendTo($.mobile.pageContainer).delay(2000)\r\n\t\t                    .fadeOut(400, function () {\r\n\t\t                        $(this).remove();\r\n\t\t                    });\r\n\t\t        }\r\n\t\t    }\r\n\t\t    function create_popup(type, title, body) {\r\n\t\t        var header = $('<div data-role=\"header\"><h2>' + title + '</h2></div>'),\r\n\t\t                content = $('<div data-role=\"content\" class=\"ui-content ui-overlay-b\">' + body\r\n\t\t                        + '</div>'),\r\n\t\t                popup = $('<div data-role=\"popup\" id=\"' + type + '\"' +\r\n\t\t                        'data-theme=\"b\" data-transition=\"slidedown\"></div>');\r\n\t\t        if (type === 'infostage') {\r\n\t\t            $('<a href=\"#\" data-rel=\"back\" class=\"ui-btn ui-corner-all' +\r\n\t\t                    'ui-btn-b ui-icon-delete ui-btn-icon-notext ui-btn-right\"></a>').appendTo(header);\r\n\t\t        }\r\n\t\t        if (type === 'displayupdates') {\r\n\t\t            $('<p class=\"center-wrapper\"><a id=\"acceptupdates\" href=\"#\" data-rel=\"back\"'\r\n\t\t                    + 'class=\"ui-btn center-button ui-mini ui-btn-inline\">'\r\n\t\t                    + strings[\"continue\"] + '</a></p>')\r\n\t\t                    .appendTo(content);\r\n\t\t            var attributes = {'data-dismissible': false, 'data-overlay-theme': \"b\"};\r\n\t\t            $(popup).attr(attributes);\r\n\t\t        }\r\n\t\t        if (type === 'displayerror') {\r\n\t\t            $('<p class=\"center-wrapper\"><a href=\"view.php?id=' + cmid +\r\n\t\t                    '\" class=\"ui-btn  center-button ui-mini ui-icon-forward ui-btn-inline ui-btn-icon-left\"'\r\n\t\t                    + 'data-ajax=\"false\">' + strings[\"continue\"] + '</a></p>')\r\n\t\t                    .appendTo(content);\r\n\t\t            var attributes = {'data-dismissible': false, 'data-overlay-theme': \"b\"};\r\n\t\t            $(popup).attr(attributes);\r\n\t\t        }\r\n\t\t        // Create the popup.\r\n\t\t        $(header)\r\n\t\t                .appendTo($(popup)\r\n\t\t                        .appendTo($.mobile.activePage)\r\n\t\t                        .popup())\r\n\t\t                .toolbar()\r\n\t\t                .after(content);\r\n\t\t        // Need it for calculate popup's dimesions when popup contents an image.\r\n\t\t        totalimg = $(content).find('img');\r\n\t\t        if (totalimg.length > 0) {\r\n\t\t            $.mobile.loading(\"show\");\r\n\t\t            totalimg.one('load', function () {\r\n\t\t                imgloaded++;\r\n\t\t                if (totalimg.length === imgloaded) {\r\n\t\t                    open_popup(popup);\r\n\t\t                    imgloaded = 0;\r\n\t\t                    // Clear the fallback\r\n\t\t                    clearTimeout(fallback);\r\n\t\t                    $.mobile.loading(\"hide\");\r\n\t\t                }\r\n\t\t            });\r\n\t\t            // Fallback in case the browser doesn't fire a load event.\r\n\t\t            var fallback = setTimeout(function () {\r\n\t\t                open_popup(popup);\r\n\t\t                $.mobile.loading(\"hide\");\r\n\t\t            }, 2000);\r\n\t\t        } else {\r\n\t\t            open_popup(popup);\r\n\t\t        }\r\n\t\t\r\n\t\t    }\r\n\t\t    function open_popup(popup) {\r\n\t\t        // Because chaining of popups not allowed in jquery mobile.\r\n\t\t        if ($(\".ui-popup-active\").length > 0) {\r\n\t\t            $(\".ui-popup\").popup(\"close\");\r\n\t\t            setTimeout(function () {\r\n\t\t                $(popup).popup(\"open\", {positionTo: \"window\"});\r\n\t\t            }, 1000);\r\n\t\t        } else {\r\n\t\t            $(popup).popup(\"open\", {positionTo: \"window\"});\r\n\t\t        }\r\n\t\t\r\n\t\t    }\r\n\t\t    function close_popup(popup) {\r\n\t\t        popup.popup(\"close\")\r\n\t\t    }\r\n\t\t    function get_block_text(title, body) {\r\n\t\t        return '<div class=\"ui-bar ui-bar-a\">' + title +\r\n\t\t                '</div><div class=\"ui-body ui-body-a\">' + body +\r\n\t\t                '</div>';\r\n\t\t    }\r\n\t\t\r\n\t\t}\r\n\t}\r\n);\r\n"],"file":"play_old.min.js"}