{"version":3,"sources":["../src/ol3-layerswitcher.js"],"names":["root","factory","define","amd","module","exports","require","LayerSwitcher","ol","control","opt_options","options","tipLabel","mapListeners","hiddenClassName","isTouchDevice_","shownClassName","element","document","createElement","className","button","setAttribute","appendChild","panel","enableTouchScroll_","this_","onmouseover","showPanel","onclick","e","window","event","preventDefault","onmouseout","contains","toElement","relatedTarget","hidePanel","Control","call","target","inherits","prototype","classList","add","renderPanel","remove","ensureTopVisibleBaseLayerShown_","firstChild","removeChild","ul","renderLayers_","getMap","setMap","map","i","length","Observable","unByKey","push","on","lastVisibleBaseLyr","forEachRecursive","l","get","getVisible","setVisible_","lyr","visible","setVisible","renderLayer_","li","lyrTitle","lyrId","uuid","label","getLayers","innerHTML","input","type","name","id","checked","onchange","htmlFor","rsl","getView","getResolution","getMaxResolution","getMinResolution","elm","lyrs","getArray","slice","reverse","fn","forEach","idx","a","replace","c","r","Math","random","v","toString","scrollStartPos","addEventListener","scrollTop","touches","pageY","createEvent"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * @module    mod_treasurehunt/ol3-layerswitcher\r\n * @package   mod_treasurehunt\r\n * @copyright 2016 onwards Adrian Rodriguez Fernandez <huorwhisp@gmail.com>\r\n * @author Adrian Rodriguez <huorwhisp@gmail.com>\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n(function (root, factory) {\r\n    if (typeof define === \"function\" && define.amd) {\r\n        define([\"mod_treasurehunt/ol\"], factory);\r\n    } else if (typeof module === \"object\" && module.exports) {\r\n        module.exports = factory(require(\"mod_treasurehunt/ol\"));\r\n    } else {\r\n        root.LayerSwitcher = factory(root.ol);\r\n    }\r\n}(this, function (ol) {\r\n    /**\r\n     * OpenLayers v3/v4 Layer Switcher Control.\r\n     * See [the examples](./examples) for usage.\r\n     * @constructor\r\n     * @extends {ol.control.Control}\r\n     * @param {Object} opt_options Control options, extends olx.control.ControlOptions adding:\r\n     *                              **`tipLabel`** `String` - the button tooltip.\r\n     */\r\n    ol.control.LayerSwitcher = function (opt_options) {\r\n\r\n        var options = opt_options || {};\r\n\r\n        var tipLabel = options.tipLabel ?\r\n                options.tipLabel : 'Legend';\r\n\r\n        this.mapListeners = [];\r\n\r\n        this.hiddenClassName = 'ol-unselectable ol-control layer-switcher';\r\n        if (ol.control.LayerSwitcher.isTouchDevice_()) {\r\n            this.hiddenClassName += ' touch';\r\n        }\r\n        this.shownClassName = 'shown';\r\n\r\n        var element = document.createElement('div');\r\n        element.className = this.hiddenClassName;\r\n\r\n        var button = document.createElement('button');\r\n        button.setAttribute('title', tipLabel);\r\n        element.appendChild(button);\r\n\r\n        this.panel = document.createElement('div');\r\n        this.panel.className = 'panel';\r\n        element.appendChild(this.panel);\r\n        ol.control.LayerSwitcher.enableTouchScroll_(this.panel);\r\n\r\n        var this_ = this;\r\n\r\n        button.onmouseover = function (e) {\r\n            this_.showPanel();\r\n        };\r\n\r\n        button.onclick = function (e) {\r\n            e = e || window.event;\r\n            this_.showPanel();\r\n            e.preventDefault();\r\n        };\r\n\r\n        this_.panel.onmouseout = function (e) {\r\n            e = e || window.event;\r\n            if (!this_.panel.contains(e.toElement || e.relatedTarget)) {\r\n                this_.hidePanel();\r\n            }\r\n        };\r\n\r\n        ol.control.Control.call(this, {\r\n            element: element,\r\n            target: options.target\r\n        });\r\n\r\n    };\r\n\r\n    ol.inherits(ol.control.LayerSwitcher, ol.control.Control);\r\n\r\n    /**\r\n     * Show the layer panel.\r\n     */\r\n    ol.control.LayerSwitcher.prototype.showPanel = function () {\r\n        if (!this.element.classList.contains(this.shownClassName)) {\r\n            this.element.classList.add(this.shownClassName);\r\n            this.renderPanel();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Hide the layer panel.\r\n     */\r\n    ol.control.LayerSwitcher.prototype.hidePanel = function () {\r\n        if (this.element.classList.contains(this.shownClassName)) {\r\n            this.element.classList.remove(this.shownClassName);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Re-draw the layer panel to represent the current state of the layers.\r\n     */\r\n    ol.control.LayerSwitcher.prototype.renderPanel = function () {\r\n\r\n        this.ensureTopVisibleBaseLayerShown_();\r\n\r\n        while (this.panel.firstChild) {\r\n            this.panel.removeChild(this.panel.firstChild);\r\n        }\r\n\r\n        var ul = document.createElement('ul');\r\n        this.panel.appendChild(ul);\r\n        this.renderLayers_(this.getMap(), ul);\r\n\r\n    };\r\n\r\n    /**\r\n     * Set the map instance the control is associated with.\r\n     * @param {ol.Map} map The map instance.\r\n     */\r\n    ol.control.LayerSwitcher.prototype.setMap = function (map) {\r\n        // Clean up listeners associated with the previous map.\r\n        for (var i = 0, key; i < this.mapListeners.length; i++) {\r\n            ol.Observable.unByKey(this.mapListeners[i]);\r\n        }\r\n        this.mapListeners.length = 0;\r\n        // Wire up listeners etc. and store reference to new map.\r\n        ol.control.Control.prototype.setMap.call(this, map);\r\n        if (map) {\r\n            var this_ = this;\r\n            this.mapListeners.push(map.on('pointerdown', function () {\r\n                this_.hidePanel();\r\n            }));\r\n            this.renderPanel();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Ensure only the top-most base layer is visible if more than one is visible.\r\n     * @private\r\n     */\r\n    ol.control.LayerSwitcher.prototype.ensureTopVisibleBaseLayerShown_ = function () {\r\n        var lastVisibleBaseLyr;\r\n        ol.control.LayerSwitcher.forEachRecursive(this.getMap(), function (l, idx, a) {\r\n            if (l.get('type') === 'base' && l.getVisible()) {\r\n                lastVisibleBaseLyr = l;\r\n            }\r\n        });\r\n        if (lastVisibleBaseLyr){\r\n            this.setVisible_(lastVisibleBaseLyr, true);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Toggle the visible state of a layer.\r\n     * Takes care of hiding other layers in the same exclusive group if the layer\r\n     * is toggle to visible.\r\n     * @private\r\n     * @param {ol.layer.Base} The layer whos visibility will be toggled.\r\n     */\r\n    ol.control.LayerSwitcher.prototype.setVisible_ = function (lyr, visible) {\r\n        var map = this.getMap();\r\n        lyr.setVisible(visible);\r\n        if (visible && lyr.get('type') === 'base') {\r\n            // Hide all other base layers regardless of grouping.\r\n            ol.control.LayerSwitcher.forEachRecursive(map, function (l, idx, a) {\r\n                if (l != lyr && l.get('type') === 'base') {\r\n                    l.setVisible(false);\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Render all layers that are children of a group.\r\n     * @private\r\n     * @param {ol.layer.Base} lyr Layer to be rendered (should have a title property).\r\n     * @param {Number} idx Position in parent group list.\r\n     */\r\n    ol.control.LayerSwitcher.prototype.renderLayer_ = function (lyr, idx) {\r\n\r\n        var this_ = this;\r\n\r\n        var li = document.createElement('li');\r\n\r\n        var lyrTitle = lyr.get('title');\r\n        var lyrId = ol.control.LayerSwitcher.uuid();\r\n\r\n        var label = document.createElement('label');\r\n\r\n        if (lyr.getLayers && !lyr.get('combine')) {\r\n\r\n            li.className = 'group';\r\n            label.innerHTML = lyrTitle;\r\n            li.appendChild(label);\r\n            var ul = document.createElement('ul');\r\n            li.appendChild(ul);\r\n\r\n            this.renderLayers_(lyr, ul);\r\n\r\n        } else {\r\n\r\n            li.className = 'layer';\r\n            var input = document.createElement('input');\r\n            if (lyr.get('type') === 'base') {\r\n                input.type = 'radio';\r\n                input.name = 'base';\r\n            } else {\r\n                input.type = 'checkbox';\r\n            }\r\n            input.id = lyrId;\r\n            input.checked = lyr.get('visible');\r\n            input.onchange = function (e) {\r\n                this_.setVisible_(lyr, e.target.checked);\r\n            };\r\n            li.appendChild(input);\r\n\r\n            label.htmlFor = lyrId;\r\n            label.innerHTML = lyrTitle;\r\n\r\n            var rsl = this.getMap().getView().getResolution();\r\n            if (rsl > lyr.getMaxResolution() || rsl < lyr.getMinResolution()) {\r\n                label.className += ' disabled';\r\n            }\r\n\r\n            li.appendChild(label);\r\n\r\n        }\r\n\r\n        return li;\r\n\r\n    };\r\n\r\n    /**\r\n     * Render all layers that are children of a group.\r\n     * @private\r\n     * @param {ol.layer.Group} lyr Group layer whos children will be rendered.\r\n     * @param {Element} elm DOM element that children will be appended to.\r\n     */\r\n    ol.control.LayerSwitcher.prototype.renderLayers_ = function (lyr, elm) {\r\n        var lyrs = lyr.getLayers().getArray().slice().reverse();\r\n        for (var i = 0, l; i < lyrs.length; i++) {\r\n            l = lyrs[i];\r\n            if (l.get('title')) {\r\n                elm.appendChild(this.renderLayer_(l, i));\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * **Static** Call the supplied function for each layer in the passed layer group\r\n     * recursing nested groups.\r\n     * @param {ol.layer.Group} lyr The layer group to start iterating from.\r\n     * @param {Function} fn Callback which will be called for each `ol.layer.Base`\r\n     * found under `lyr`. The signature for `fn` is the same as `ol.Collection#forEach`\r\n     */\r\n    ol.control.LayerSwitcher.forEachRecursive = function (lyr, fn) {\r\n        lyr.getLayers().forEach(function (lyr, idx, a) {\r\n            fn(lyr, idx, a);\r\n            if (lyr.getLayers) {\r\n                ol.control.LayerSwitcher.forEachRecursive(lyr, fn);\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Generate a UUID\r\n     * @returns {String} UUID\r\n     *\r\n     * Adapted from http://stackoverflow.com/a/2117523/526860\r\n     */\r\n    ol.control.LayerSwitcher.uuid = function () {\r\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\r\n            return v.toString(16);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     * @desc Apply workaround to enable scrolling of overflowing content within an\r\n     * element. Adapted from https://gist.github.com/chrismbarr/4107472\r\n     */\r\n    ol.control.LayerSwitcher.enableTouchScroll_ = function (elm) {\r\n        if (ol.control.LayerSwitcher.isTouchDevice_()) {\r\n            var scrollStartPos = 0;\r\n            elm.addEventListener(\"touchstart\", function (event) {\r\n                scrollStartPos = this.scrollTop + event.touches[0].pageY;\r\n            }, false);\r\n            elm.addEventListener(\"touchmove\", function (event) {\r\n                this.scrollTop = scrollStartPos - event.touches[0].pageY;\r\n            }, false);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     * @desc Determine if the current browser supports touch events. Adapted from\r\n     * https://gist.github.com/chrismbarr/4107472\r\n     */\r\n    ol.control.LayerSwitcher.isTouchDevice_ = function () {\r\n        try {\r\n            document.createEvent(\"TouchEvent\");\r\n            return true;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    };\r\n    var LayerSwitcher = ol.control.LayerSwitcher;\r\n    return LayerSwitcher;\r\n}));\r\n"],"file":"ol3-layerswitcher.min.js"}