{"version":3,"sources":["../src/viewgpx.js"],"names":["define","$","jqui","touch","notification","ol","olLayerSwitcher","str","console","log","jquery","refreshTracksInterval","refreshCounter","addgpxlayer","map","cmid","treasurehuntid","strings","user","trackgroupname","trackgroup","find_or_add_layergroup","load_gpx","creategpxviewer","users","custommapconfig","refreshinterval","terms","stringsqueried","term","key","component","users_param","get_strings","done","i18n","i","length","custombackgroundurl","img","Image","addEventListener","imgwidth","naturalWidth","imgheight","naturalHeight","initcreategpxviewer","src","custombaselayer","customimageextent","proj","transformExtent","bbox","geographic","bboxwidth","bboxheight","centerwidth","centerheight","ratiorealmap","Math","round","adjwidth","adjheight","layer","title","layername","type","layertype","source","ImageStatic","url","imageExtent","opacity","wmsurl","options","TileWMS","params","wmsparams","customwmsextent","extent","Tile","basemaps","Group","layers","visible","BingMaps","imagerySet","maxZoom","OSM","onlybase","getLayers","clear","push","tracks","heatmap","Heatmap","Vector","format","GPX","blur","radius","layerSwitcher","control","LayerSwitcher","Map","renderer","target","document","getElementById","view","View","center","zoom","minZoom","controls","defaults","extend","showPanel","selectSingleClick","interaction","Select","style","feature","getLayer","iconurl","selectedstyle","trackStyleFunction","addInteraction","popup","Overlay","element","addOverlay","displayFeatureInfo","pixel","features","msg","forEachFeatureAtPixel","info","ii","get","join","getTarget","cursor","showpopup","evt","getElement","coordinate","popover","setPosition","getEventPixel","originalEvent","on","dragging","interval","change","is","show","setInterval","text","hide","clearInterval","layergroup","forEach","addLayer","flyTo","point","getView","fit","duration","animate","tracksGroup","max_extent","gpxsource","id","a","pic","indexOf","b","substring","vector","fullname","refresh","getVisible","getSource","getExtent","min","max","renderPanel","icon","selected","styles","Style","stroke","Stroke","color","width","zIndex","lineDash","fill","Fill","image","Circle","geometry","coordinates","getGeometry","getCoordinates","geom","MultiPoint","coord","getLastCoordinate","Point","Icon","anchor","rotateWithView"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * @module    mod_treasurehunt/viewgpx\r\n * @package   mod_treasurehunt\r\n * @copyright 2016 onwards Adrian Rodriguez Fernandez <huorwhisp@gmail.com>, Juan Pablo de Castro <jpdecastro@tel.uva.es>\r\n * @author Adrian Rodriguez <huorwhisp@gmail.com>\r\n * @author Juan Pablo de Castro <jpdecastro@tel.uva.es>\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['jquery', 'jqueryui', 'mod_treasurehunt/jquery-ui-touch-punch', 'core/notification',\r\n\t\t'mod_treasurehunt/ol',  'mod_treasurehunt/ol3-layerswitcher', 'core/str'],\r\n        function ($, jqui, touch, notification, ol, olLayerSwitcher, str) {\r\n            console.log('Loading viewgpx.js with jquery ' + $().jquery);\r\n\t\t\tvar refreshTracksInterval = 30;\r\n\t\t\tvar refreshCounter = 0;\r\n            var init = {\r\n                addgpxlayer: function (map, cmid, treasurehuntid, strings, user, trackgroupname) {\r\n\r\n                    var trackgroup = find_or_add_layergroup(map, trackgroupname);\r\n\r\n                    load_gpx([user], cmid, map, trackgroup, null);\r\n                    return trackgroup;\r\n                },\r\n                // @param users = \"global\" obtain data from users_param. The list of user structures.\r\n                creategpxviewer: function (cmid, treasurehuntid, users, custommapconfig, refreshinterval) {\r\n                    console.log('Creating gpxviewer.');\r\n                    // I18n strings.\r\n\t            \tvar terms = ['aerialmap', 'roadmap', 'basemaps', 'searchlocation', 'trackviewer'];\r\n\t            \tvar stringsqueried = terms.map(function (term) {\r\n\t                     return {key: term, component: 'treasurehunt'};\r\n\t                });\r\n                    refreshTracksInterval = refreshinterval;\r\n                    if (users == 'global') {\r\n                        // Get users from global (due to excessive size for AMD api).\r\n                        var users = users_param;\r\n                    }\r\n\t            \tstr.get_strings(stringsqueried).done(function (strings) {\r\n                        console.log('I18N strings loaded.');\r\n\t            \t\tvar i18n = [];\r\n\t            \t\tfor (var i=0; i < terms.length; i++) {\r\n\t            \t\t\ti18n[terms[i]] = strings[i];\r\n\t            \t\t}\r\n\t            \t\t// Detect custom image.\r\n\t            \t\tif (typeof(custommapconfig) != 'undefined' &&\r\n\t            \t\t\t\tcustommapconfig !== null && \r\n\t            \t\t\t\tcustommapconfig.custombackgroundurl !== null) {\r\n\t            \t\t\t\r\n\t            \t\t\t// Detect image size.\r\n\t    \t\t\t\t\t\tvar img = new Image();\r\n\t    \t\t\t\t\t    img.addEventListener(\"load\", function(){\r\n\t    \t\t\t\t\t    \tcustommapconfig.imgwidth =  this.naturalWidth;\r\n\t    \t\t\t\t\t    \tcustommapconfig.imgheight = this.naturalHeight;\r\n\t    \t\t\t\t\t    \tinitcreategpxviewer(cmid, treasurehuntid, i18n, users, custommapconfig);\t    \t\t\t\t\t        \r\n\t    \t\t\t\t\t    });\r\n\t    \t\t\t\t\t    img.src = custommapconfig.custombackgroundurl;\r\n\t            \t\t} else {\r\n\t            \t\t\tinitcreategpxviewer(cmid, treasurehuntid, i18n, users, custommapconfig);\r\n\t            \t\t}\r\n\t                })\r\n\t\t\t\t}  // End of function creategpxviewer.\r\n            };\r\n            return init;\r\n            \r\n            function initcreategpxviewer(cmid, treasurehuntid, strings, users, custommapconfig) {\r\n                    console.log('Init gpx viewer.');\r\n    \t\t\t\tvar mapprojection = 'EPSG:3857';\r\n    \t\t\t\tvar custombaselayer = null;\r\n    \t\t\t\tvar geographictools = true;\r\n    \t\t\t\t// Support customized base layers.\r\n    \t\t\t\tif (typeof(custommapconfig) != 'undefined' && custommapconfig != null) {\r\n    \t\t\t\t\tif (custommapconfig.custombackgroundurl != null) {\r\n    \t\t\t\t\t\tvar customimageextent = ol.proj.transformExtent(custommapconfig.bbox, 'EPSG:4326', mapprojection);\r\n    \t\t\t\t\t\tif (!custommapconfig.geographic) {\r\n    \t\t\t\t\t\t\t// Round bbox and scales to allow vectorial SVG rendering. (Maintain ratio.)\r\n    \t\t\t\t\t\t\tvar bboxwidth = customimageextent[2] - customimageextent[0];\r\n    \t\t\t\t\t\t\tvar bboxheight = customimageextent[3] - customimageextent[1];\r\n    \t\t\t\t\t\t\tvar centerwidth = (customimageextent[2] + customimageextent[0]) / 2;\r\n    \t\t\t\t\t\t\tvar centerheight = (customimageextent[3] + customimageextent[1]) / 2;\r\n    \t\t\t\t\t\t\t\r\n    \t\t\t\t\t\t\tvar ratiorealmap = Math.round(bboxheight / custommapconfig.imgheight);\r\n    \t\t\t\t\t\t\tvar adjwidth = Math.round(custommapconfig.imgwidth * ratiorealmap);\r\n    \t\t\t\t\t\t\tvar adjheight = Math.round(custommapconfig.imgheight * ratiorealmap);\r\n    \t\t\t\t\t\t\tcustomimageextent = [centerwidth - adjwidth/2,\r\n    \t\t\t\t\t\t\t\tcenterheight - adjheight/2,\r\n    \t\t\t\t\t\t\t\tcenterwidth + adjwidth/2,\r\n    \t\t\t\t\t\t\t\tcenterheight + adjheight/2];\r\n    \t\t\t\t\t\t}\r\n    \t\t\t\t\t\t\r\n    \t\t\t\t\t\tcustombaselayer = new ol.layer.Image({\r\n    \t\t\t\t\t\t\t  title : custommapconfig.layername,\r\n    \t\t\t\t\t\t\t  type: custommapconfig.layertype,\r\n    \t\t\t\t\t\t      source: new ol.source.ImageStatic({\r\n    \t\t\t\t\t\t        url: custommapconfig.custombackgroundurl,\r\n    \t\t\t\t\t\t        imageExtent: customimageextent,\r\n    \t\t\t\t\t\t      }),\r\n    \t\t\t\t\t\t      opacity: 1.0\r\n    \t\t\t\t\t\t    });\r\n    \t\t\t\t\t} else if (custommapconfig.wmsurl != null) {\r\n    \t\t\t\t\t\tvar options = {\r\n    \t\t\t\t\t\t\t\t\tsource: new ol.source.TileWMS({\r\n    \t\t\t\t\t\t\t            url: custommapconfig.wmsurl,\r\n    \t\t\t\t\t\t\t            params: custommapconfig.wmsparams,\r\n    \t\t\t\t\t\t\t          }),\r\n    \t\t\t\t\t\t\t\t\ttype: custommapconfig.layertype,\r\n    \t\t\t\t\t\t\t\t\ttitle: custommapconfig.layername,\r\n    \t\t\t\t\t\t        };\r\n    \t\t\t\t\t\tif (custommapconfig.bbox[0] != null &&\r\n    \t\t\t\t\t\t\t\tcustommapconfig.bbox[1] != null &&\r\n    \t\t\t\t\t\t\t\tcustommapconfig.bbox[2] != null &&\r\n    \t\t\t\t\t\t\t\tcustommapconfig.bbox[3] != null) {\r\n    \t\t\t\t\t\t\tvar customwmsextent = ol.proj.transformExtent(custommapconfig.bbox, 'EPSG:4326', mapprojection);\r\n    \t\t\t\t\t\t\toptions.extent = customwmsextent;\r\n    \t\t\t\t\t\t}\r\n    \t\t\t\t\t\tcustombaselayer = new ol.layer.Tile(options);\r\n    \t\t\t\t\t}\r\n    \t\t\t\t\tgeographictools = custommapconfig.geographic;\r\n    \t\t\t\t}\r\n                    var basemaps = new ol.layer.Group({\r\n                        'title': strings['basemaps'],\r\n                        layers: [\r\n                            new ol.layer.Tile({\r\n                                title: strings['aerialmap'],\r\n                                type: 'base',\r\n                                visible: false,\r\n                                source: new ol.source.BingMaps({\r\n                                    key: 'AmC3DXdnK5sXC_Yp_pOLqssFSaplBbvN68jnwKTEM3CSn2t6G5PGTbYN3wzxE5BR',\r\n                                    imagerySet: 'AerialWithLabels',\r\n                                    maxZoom: 19\r\n                                            // Use maxZoom 19 to see stretched tiles instead of the BingMaps\r\n                                            // \"no photos at this zoom level\" tiles\r\n                                            // maxZoom: 19.\r\n                                })\r\n                            }), new ol.layer.Tile({\r\n                                title: strings['roadmap'],\r\n                                type: 'base',\r\n                                visible: true,\r\n                                source: new ol.source.OSM()\r\n                            })\r\n                        ]\r\n                    });\r\n                    if (custombaselayer !== null) {\r\n    \t\t\t\t\tif (custommapconfig.onlybase) {\r\n    \t\t\t\t\t\tbasemaps.getLayers().clear();\r\n    \t\t\t\t\t}\r\n    \t\t\t\t\tbasemaps.getLayers().push(custombaselayer);\r\n    \t\t\t\t}\r\n                    var tracks = new ol.layer.Group({\r\n                        'title': strings['trackviewer'],\r\n                        layers: []});\r\n                    // TODO: test and include heatmap layer.\r\n                    var heatmap = new ol.layer.Heatmap({\r\n                        title: 'Heatmap',\r\n                        source: new ol.source.Vector({\r\n                            url: 'gpx.php?id=' + cmid + '&userid=24', // + users.map(function(e){return e.id;}),\r\n                            format: new ol.format.GPX()\r\n                        }),\r\n                        blur: 20,\r\n                        radius: 10\r\n                    });\r\n\r\n                    var layerSwitcher = new ol.control.LayerSwitcher();\r\n                    var map = new ol.Map({\r\n                        layers: [basemaps, tracks],\r\n                        renderer: 'canvas',\r\n                        target: document.getElementById('mapgpx'),\r\n                        view: new ol.View({\r\n                            center: [0, 0],\r\n                            zoom: 2,\r\n                            minZoom: 2\r\n                        }),\r\n                        controls: ol.control.defaults().extend([layerSwitcher])\r\n                    });\r\n                    console.log('Map created in mapgpx!');\r\n                    layerSwitcher.showPanel();\r\n                    var selectSingleClick = new ol.interaction.Select({\r\n                    \tstyle: function (feature) {\r\n                    \t\tvar layer = selectSingleClick.getLayer(feature);\r\n                    \t\tvar iconurl = layer.iconurl;\r\n                            var selectedstyle = trackStyleFunction(feature, iconurl, true);\r\n                            return selectedstyle;\r\n                        }\r\n                    });\r\n                    map.addInteraction(selectSingleClick);\r\n                    load_gpx(users, cmid, map, tracks, layerSwitcher);\r\n                    // Popup showing the position the user clicked.\r\n                    var popup = new ol.Overlay({\r\n                        element: document.getElementById('info')\r\n                    });\r\n                    map.addOverlay(popup);\r\n                    function displayFeatureInfo(pixel) {\r\n                        var features = [];\r\n                        var msg = '';\r\n                        map.forEachFeatureAtPixel(pixel, function (feature) {\r\n                            features.push(feature);\r\n                        });\r\n                        if (features.length > 0) {\r\n                            var info = [];\r\n                            var i, ii;\r\n                            for (i = 0, ii = features.length; i < ii; ++i) {\r\n                                info.push(features[i].get('desc'));\r\n                            }\r\n                            msg = info.join(', ') || '(unknown)';\r\n                            map.getTarget().style.cursor = 'pointer';\r\n                        } else {\r\n                            map.getTarget().style.cursor = '';\r\n                        }\r\n                        return msg;\r\n                    }\r\n                    \r\n                    function showpopup(evt) {\r\n                        var element = popup.getElement();\r\n                        var coordinate = evt.coordinate;\r\n                        $(element).popover('destroy');\r\n                        popup.setPosition(coordinate);\r\n                        $(element).popover({\r\n                            'placement': 'top',\r\n                            'animation': false,\r\n                            'html': true,\r\n                            'content': displayFeatureInfo(map.getEventPixel(evt.originalEvent))\r\n                        });\r\n                        $(element).popover('show');\r\n                    }\r\n                    map.on('pointermove', function (evt) {\r\n                        if (evt.dragging) {\r\n                            return;\r\n                        }\r\n                    });\r\n                    map.on('click', function (evt) {\r\n                        showpopup(evt);\r\n                    });\r\n                    var interval = null;\r\n                    $('#refreshtracks').change(function() {\r\n                    \tif ($(this).is(':checked')) {\r\n                    \t\trefreshCounter = 0;\r\n                    \t\t$(\"#timecircle\").show();\r\n                    \t\tinterval = setInterval(function() {\r\n                    \t\t\t$(\"#timecircle\").text(refreshTracksInterval - (refreshCounter++) % refreshTracksInterval);\r\n\t\t\t\t\t\t\t}, 1000);\r\n                    \t} else {\r\n                    \t\t$(\"#timecircle\").hide();\r\n                    \t\tclearInterval(interval);\r\n                    \t}\r\n                    });\r\n                } // End of function initcreategpxviewer.\r\n            \r\n            function find_or_add_layergroup(map, trackgroupname) {\r\n                var layergroup = null;\r\n                var layers = map.getLayers();\r\n                layers.forEach(function (layer) {\r\n                    if (layer.get('title') == trackgroupname) {\r\n                        layergroup = layer;\r\n                    }\r\n                });\r\n\r\n                if (!layergroup) {\r\n                    layergroup = new ol.layer.Group({\r\n                        'title': trackgroupname,\r\n                        layers: []});\r\n                    map.addLayer(layergroup);\r\n                }\r\n                return layergroup;\r\n            }\r\n            function flyTo(map, point, extent) {\r\n                var duration = 700;\r\n                var view = map.getView();\r\n                if (extent) {\r\n                    view.fit(extent, {\r\n                        duration: duration\r\n                    });\r\n                } else {\r\n                    view.animate({\r\n                        zoom: 19,\r\n                        center: point,\r\n                        duration: duration\r\n                    });\r\n                }\r\n            }\r\n            function load_gpx(users, cmid, map, tracksGroup, layerSwitcher) {\r\n                var max_extent = null;\r\n                users.forEach(function (user) {\r\n                    var gpxsource = new ol.source.Vector({\r\n                        url: 'gpx.php?id=' + cmid + '&userid=' + user.id,\r\n                        format: new ol.format.GPX()\r\n                    });\r\n                    var a = user.pic.indexOf('<img src=\"') + 10;\r\n                    var b = user.pic.indexOf('\"', a);\r\n                    var iconurl = user.pic.substring(a, b);\r\n                    \r\n                    var vector = new ol.layer.Vector({\r\n                        source: gpxsource,\r\n                        title: user.pic + '' + user.fullname,\r\n                        style: function (feature) {\r\n                            var selectedstyle = trackStyleFunction(feature, iconurl, false);\r\n                            return selectedstyle;\r\n                        }\r\n                    });\r\n                    vector.iconurl = iconurl;\r\n                    setInterval(function() {\r\n                    \tif ($('#refreshtracks').is(':checked')) {\r\n                    \t\trefreshCounter = 0;\r\n                    \t\tgpxsource.clear();\r\n                    \t\tgpxsource.refresh();                    \t\t\r\n                    \t}\r\n                    }, refreshTracksInterval * 1000);\r\n                    vector.on('change:visible', function() {\r\n                    \tif (this.getVisible()) {\r\n                    \t\tvar extent = this.getSource().getExtent();\r\n                    \t\tflyTo(map, null, extent);\r\n                    \t}\r\n                    });\r\n                    gpxsource.on('change', function () {\r\n                    \tif ($('#refreshtracks').is(':checked')) {\r\n                    \t\treturn;\r\n                    \t} \r\n                        var extent = gpxsource.getExtent();\r\n                        if (max_extent === null) {\r\n                            max_extent = extent;\r\n                        } else {\r\n                            max_extent[0] = Math.min(max_extent[0], extent[0]);\r\n                            max_extent[1] = Math.min(max_extent[1], extent[1]);\r\n                            max_extent[2] = Math.max(max_extent[2], extent[2]);\r\n                            max_extent[3] = Math.max(max_extent[3], extent[3]);\r\n                        }\r\n                        flyTo(map, null, max_extent);\r\n                    }, this);\r\n                    tracksGroup.getLayers().push(vector);\r\n                    if (layerSwitcher) {\r\n                        layerSwitcher.renderPanel();\r\n                    }\r\n                });\r\n            }\r\n            function trackStyleFunction(feature, icon, selected) {\r\n                var styles = [\r\n                    // ...shadow.\r\n                    new ol.style.Style({\r\n                        stroke: new ol.style.Stroke({\r\n                            color: 'rgba(255,255,255,0.8)',\r\n                            width: 6 + 2 * selected\r\n                        }),\r\n                        zIndex: 1 + selected * 4\r\n                    }),\r\n                    new ol.style.Style({\r\n                        stroke: new ol.style.Stroke({\r\n                            color: '#ff0000',\r\n                            width: 1 + selected,\r\n                            lineDash: [10, 8],\r\n                        }),\r\n                        fill: new ol.style.Fill({\r\n                            color: 'rgba(255,0,0,0.5)'\r\n                        }),\r\n                        zIndex: 2 + selected * 4\r\n                    }),\r\n                    new ol.style.Style({\r\n                        image: new ol.style.Circle({\r\n                          radius: 3 + 2 * selected,\r\n                          stroke: new ol.style.Stroke({\r\n                        \t  color: 'white',\r\n                        \t  width: 1 + selected\r\n                          }),\r\n                          fill: new ol.style.Fill({\r\n                            color: 'red'\r\n                          })\r\n                        }),\r\n                        geometry: function(feature) {\r\n                          // return the coordinates of the first ring of the polygon\r\n                          var coordinates = feature.getGeometry().getCoordinates()[0];\r\n                          return new ol.geom.MultiPoint(coordinates);\r\n                        },\r\n                        zIndex: 3 + selected * 4\r\n                      })\r\n                ];\r\n                var geometry = feature.getGeometry();\r\n                var coord = geometry.getLastCoordinate();\r\n                styles.push(new ol.style.Style({\r\n                    geometry: new ol.geom.Point(coord),\r\n                    image: new ol.style.Icon({\r\n                        src: icon,\r\n                        anchor: [0.75, 0.5],\r\n                        rotateWithView: false,\r\n                    }),\r\n                    zIndex: 4 + selected * 4\r\n                }));\r\n                return styles;\r\n            }\r\n        });\r\n"],"file":"viewgpx.min.js"}